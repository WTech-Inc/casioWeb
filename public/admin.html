<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ç®¡ç†å“¡å¾Œå° - å¿«æ´»å¨›æ¨‚åŸ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --admin-blue: #1a365d;
            --admin-dark: #2d3748;
            --admin-light: #4a5568;
            --danger: #e53e3e;
            --warning: #d69e2e;
            --success: #38a169;
            --info: #4299e1;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            background: #f7fafc;
            color: #2d3748;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* å´é‚Šæ¬„ */
        .sidebar {
            width: 250px;
            background: var(--admin-blue);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: #cbd5e0;
            text-decoration: none;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: var(--success);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        /* ä¸»å…§å®¹å€ */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .top-bar {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--admin-blue);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--admin-light);
            font-size: 0.9rem;
        }
        
        .stat-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .positive { color: var(--success); }
        .negative { color: var(--danger); }
        
        /* è¡¨æ ¼ */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f7fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--admin-light);
            border-bottom: 1px solid #e2e8f0;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        /* æŒ‰éˆ• */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: var(--admin-blue);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        /* æ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* è¡¨å–® */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--admin-blue);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        /* åœ–è¡¨å®¹å™¨ */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        /* åˆ†é  */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background: var(--admin-blue);
            color: white;
            border-color: var(--admin-blue);
        }
        
        /* éŠæˆ²è¨­å®šå°ˆç”¨æ¨£å¼ */
        .range-slider {
            width: 100%;
            margin-top: 10px;
            -webkit-appearance: none;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            outline: none;
        }
        
        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--admin-blue);
            border-radius: 50%;
            cursor: pointer;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .icon-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .icon-card:hover {
            border-color: var(--admin-blue);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .icon-display {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .icon-name {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .icon-category {
            font-size: 0.8rem;
            color: var(--admin-light);
            background: #f7fafc;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .game-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .game-card:hover {
            border-color: var(--admin-blue);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }
        
        .game-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .status-inactive {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .game-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item {
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-weight: 600;
            color: var(--admin-blue);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--admin-light);
        }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .category-tab:hover {
            border-color: var(--admin-blue);
        }
        
        .category-tab.active {
            background: var(--admin-blue);
            color: white;
            border-color: var(--admin-blue);
        }
        
        .emoji-item {
            display: inline-block;
            padding: 8px;
            margin: 2px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        
        .emoji-item:hover {
            background: #e2e8f0;
            transform: scale(1.1);
        }
        
        .selected-emoji {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 1.1rem;
        }
        
        /* è¡¨æ ¼å‹•ä½œæŒ‰éˆ•çµ„ */
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        /* é€šçŸ¥è¨Šæ¯ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            animation: slideInRight 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 400px;
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--admin-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æœå°‹æ¡† */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--admin-light);
        }
        
        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 1024px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-title span, .nav-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
        
        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            
            .icon-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* ç‹€æ…‹æŒ‡ç¤ºç‡ˆ */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: var(--success);
        }
        
        .status-offline {
            background: var(--danger);
        }
        
        /* é€²åº¦æ¢ */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--success);
            transition: width 0.3s;
        }
        
        /* å¿«é€Ÿå‹•ä½œæŒ‰éˆ• */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .quick-action-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .quick-action-card:hover {
            border-color: var(--admin-blue);
            transform: translateY(-5px);
        }
        
        .quick-action-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--admin-blue);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- å´é‚Šæ¬„ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">
                    <i class="fas fa-cog"></i>
                    <span>ç®¡ç†å¾Œå°</span>
                </h1>
            </div>
            
            <div class="nav-menu">
                <a class="nav-item active" onclick="showDashboard()">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>å„€è¡¨æ¿</span>
                </a>
                <a class="nav-item" onclick="showUsers()">
                    <i class="fas fa-users"></i>
                    <span>ç©å®¶ç®¡ç†</span>
                </a>
                <a class="nav-item" onclick="showGames()">
                    <i class="fas fa-gamepad"></i>
                    <span>éŠæˆ²è¨˜éŒ„</span>
                </a>
                <a class="nav-item" onclick="showFinancial()">
                    <i class="fas fa-chart-line"></i>
                    <span>è²¡å‹™å ±è¡¨</span>
                </a>
                <a class="nav-item" onclick="showGameSettings()">
                    <i class="fas fa-sliders-h"></i>
                    <span>éŠæˆ²è¨­å®š</span>
                </a>
                <a class="nav-item" onclick="showIconManager()">
                    <i class="fas fa-icons"></i>
                    <span>åœ–æ¨™ç®¡ç†</span>
                </a>
                <a class="nav-item" onclick="showSystem()">
                    <i class="fas fa-server"></i>
                    <span>ç³»çµ±è¨­ç½®</span>
                </a>
            </div>
        </div>
        
        <!-- ä¸»å…§å®¹å€ -->
        <div class="main-content">
            <!-- é ‚éƒ¨å°èˆª -->
            <div class="top-bar">
                <h2 class="page-title" id="page-title">å„€è¡¨æ¿</h2>
                <div class="user-info">
                    <span id="admin-name">è¼‰å…¥ä¸­...</span>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        ç™»å‡º
                    </button>
                </div>
            </div>
            
            <!-- å…§å®¹å€åŸŸ -->
            <div id="content-area">
                <!-- å…§å®¹æœƒç”± JavaScript å‹•æ…‹è¼‰å…¥ -->
            </div>
        </div>
    </div>
    
    <!-- ä¿®æ”¹ç©å®¶ç±Œç¢¼æ¨¡æ…‹æ¡† -->
    <div class="modal" id="edit-chips-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ä¿®æ”¹ç©å®¶ç±Œç¢¼</h3>
                <button class="btn" onclick="closeModal('edit-chips-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ç©å®¶ ID</label>
                    <input type="text" id="edit-player-id" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">ç©å®¶åç¨±</label>
                    <input type="text" id="edit-player-name" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">ç›®å‰ç±Œç¢¼</label>
                    <input type="number" id="edit-current-chips" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">æ–°ç±Œç¢¼æ•¸é‡</label>
                    <input type="number" id="edit-new-chips" class="form-input" min="0" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('edit-chips-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="updatePlayerChips()">ç¢ºèªä¿®æ”¹</button>
            </div>
        </div>
    </div>
    
    <!-- é‡ç½®è³‡æ–™åº«æ¨¡æ…‹æ¡† -->
    <div class="modal" id="reset-db-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: var(--danger);">
                    <i class="fas fa-exclamation-triangle"></i>
                    é‡ç½®è³‡æ–™åº«
                </h3>
                <button class="btn" onclick="closeModal('reset-db-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--danger); font-weight: bold;">
                    âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°‡æœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼ŒåŒ…æ‹¬ï¼š
                </p>
                <ul style="color: var(--danger); margin: 15px 0;">
                    <li>æ‰€æœ‰ç©å®¶å¸³è™Ÿ</li>
                    <li>æ‰€æœ‰éŠæˆ²è¨˜éŒ„</li>
                    <li>æ‰€æœ‰å……å€¼è¨˜éŒ„</li>
                    <li>æ‰€æœ‰æœƒè©±è³‡æ–™</li>
                    <li>æ‰€æœ‰è¨­å®šè³‡æ–™</li>
                </ul>
                <p>æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p>
                <div class="form-group">
                    <label class="form-label">
                        è«‹è¼¸å…¥ "YES_RESET" ç¢ºèªé‡ç½®
                    </label>
                    <input type="text" id="reset-confirm" class="form-input" 
                           placeholder="è¼¸å…¥ YES_RESET ç¢ºèª">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('reset-db-modal')">å–æ¶ˆ</button>
                <button class="btn btn-danger" onclick="confirmResetDatabase()">é‡ç½®è³‡æ–™åº«</button>
            </div>
        </div>
    </div>
    
    <!-- éŠæˆ²è¨­å®šç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div class="modal" id="edit-game-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç·¨è¼¯éŠæˆ²è¨­å®š</h3>
                <button class="btn" onclick="closeModal('edit-game-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="game-settings-form">
                    <input type="hidden" id="edit-game-id">
                    
                    <div class="form-group">
                        <label class="form-label">éŠæˆ²åç¨±</label>
                        <input type="text" id="edit-game-name" class="form-input" readonly>
                    </div>
                    
                    <div class="form-row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">å‹ç‡ (%)</label>
                            <input type="number" id="edit-win-rate" class="form-input" 
                                   min="0" max="100" step="0.1" required>
                            <div class="range-display">
                                <input type="range" id="win-rate-slider" min="0" max="100" step="0.1" 
                                       class="range-slider" oninput="updateWinRate(this.value)">
                            </div>
                        </div>
                        
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">æ³¢å‹•ç‡ (%)</label>
                            <input type="number" id="edit-volatility" class="form-input" 
                                   min="0" max="100" step="0.1" required>
                            <div class="range-display">
                                <input type="range" id="volatility-slider" min="0" max="100" step="0.1" 
                                       class="range-slider" oninput="updateVolatility(this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">æœ€ä½ä¸‹æ³¨</label>
                            <input type="number" id="edit-min-bet" class="form-input" min="1" required>
                        </div>
                        
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">æœ€é«˜ä¸‹æ³¨</label>
                            <input type="number" id="edit-max-bet" class="form-input" min="1" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jackpot æ©Ÿç‡ (%)</label>
                        <input type="number" id="edit-jackpot-chance" class="form-input" 
                               min="0" max="100" step="0.01">
                        <small style="color: #666;">è¨­å®šç‚º 0 è¡¨ç¤ºç„¡ Jackpot</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="edit-is-active"> å•Ÿç”¨éŠæˆ²
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">éŠæˆ²æè¿°</label>
                        <textarea id="edit-description" class="form-input" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('edit-game-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveGameSettings()">ä¿å­˜è¨­å®š</button>
            </div>
        </div>
    </div>
    
    <!-- åœ–æ¨™ç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div class="modal" id="edit-icon-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç·¨è¼¯åœ–æ¨™</h3>
                <button class="btn" onclick="closeModal('edit-icon-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="icon-edit-form">
                    <input type="hidden" id="edit-icon-id">
                    
                    <div class="form-group">
                        <label class="form-label">åœ–æ¨™åç¨±</label>
                        <input type="text" id="edit-icon-name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">åœ–æ¨™ä»£ç¢¼</label>
                        <input type="text" id="edit-icon-code" class="form-input" required>
                        <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                            <strong>é è¦½:</strong> <span id="icon-preview" style="font-size: 24px;"></span>
                        </div>
                    </div>
                    
                    <div class="form-row" style="display: flex; gap: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">åˆ†é¡</label>
                            <select id="edit-icon-category" class="form-input">
                                <option value="general">ä¸€èˆ¬</option>
                                <option value="slots">è€è™æ©Ÿ</option>
                                <option value="cards">æ’²å…‹ç‰Œ</option>
                                <option value="dice">éª°å­</option>
                                <option value="currency">è²¨å¹£</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">æ’åº</label>
                            <input type="number" id="edit-icon-order" class="form-input" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="edit-icon-active" checked> å•Ÿç”¨åœ–æ¨™
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('edit-icon-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveIcon()">ä¿å­˜åœ–æ¨™</button>
            </div>
        </div>
    </div>
    
    <!-- æ‰¹é‡åŒ¯å…¥åœ–æ¨™æ¨¡æ…‹æ¡† -->
    <div class="modal" id="import-icons-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ‰¹é‡åŒ¯å…¥åœ–æ¨™</h3>
                <button class="btn" onclick="closeModal('import-icons-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">åŒ¯å…¥æ ¼å¼ (JSON)</label>
                    <textarea id="import-icons-data" class="form-input" rows="10" placeholder='[
  {
    "icon_name": "æ„›å¿ƒ",
    "icon_code": "â¤ï¸",
    "category": "general"
  },
  {
    "icon_name": "é–ƒé›»",
    "icon_code": "âš¡",
    "category": "general"
  }
]'></textarea>
                    <small style="color: #666;">æ¯å€‹åœ–æ¨™éœ€åŒ…å« icon_name, icon_code, category (å¯é¸)</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">æˆ–å¾ Emoji æ¸…å–®é¸æ“‡</label>
                    <div id="emoji-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px;">
                        <!-- Emoji æ¸…å–®æœƒå‹•æ…‹è¼‰å…¥ -->
                    </div>
                    <small style="color: #666;">é»æ“Š Emoji å°‡å…¶åŠ å…¥åŒ¯å…¥æ¸…å–®</small>
                </div>
                
                <div id="selected-emojis" style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 5px; min-height: 50px;">
                    <strong>å·²é¸æ“‡çš„ Emoji:</strong>
                    <div id="emoji-selection" style="margin-top: 5px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('import-icons-modal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="importIcons()">é–‹å§‹åŒ¯å…¥</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šæ•¸
        let currentAdmin = null;
        let currentSection = 'dashboard';
        let currentUsersPage = 1;
        let currentGamesPage = 1;
        let selectedEmojis = [];
        
        // æª¢æŸ¥ç®¡ç†å“¡ç™»å…¥ç‹€æ…‹
        async function checkAdminAuth() {
            try {
                showLoading();
                const sessionId = localStorage.getItem('sessionId');
                if (!sessionId) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const response = await fetch('/api/admin/check', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (!data.success || !data.isAdmin) {
                    window.location.href = 'index.html';
                    return;
                }
                
                currentAdmin = data.user;
                document.getElementById('admin-name').textContent = currentAdmin.username;
                
                // è¼‰å…¥é è¨­é é¢
                await showDashboard();
                hideLoading();
            } catch (error) {
                console.error('é©—è­‰å¤±æ•—:', error);
                window.location.href = 'login.html';
            }
        }
        
        // ç™»å‡º
        function logout() {
            const sessionId = localStorage.getItem('sessionId');
            
            if (sessionId) {
                fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: { 'session-id': sessionId }
                }).catch(() => {});
            }
            
            localStorage.removeItem('sessionId');
            window.location.href = 'login.html';
        }
        
        // æ›´æ–°å°èˆªæ¿€æ´»ç‹€æ…‹
        function updateActiveNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.querySelector('span').textContent === getPageTitle()) {
                    item.classList.add('active');
                }
            });
        }
        
        // ç²å–é é¢æ¨™é¡Œ
        function getPageTitle() {
            const titles = {
                'dashboard': 'å„€è¡¨æ¿',
                'users': 'ç©å®¶ç®¡ç†',
                'games': 'éŠæˆ²è¨˜éŒ„',
                'financial': 'è²¡å‹™å ±è¡¨',
                'game-settings': 'éŠæˆ²è¨­å®š',
                'icon-manager': 'åœ–æ¨™ç®¡ç†',
                'system': 'ç³»çµ±è¨­ç½®'
            };
            return titles[currentSection] || 'å„€è¡¨æ¿';
        }
        
        // é¡¯ç¤ºå„€è¡¨æ¿
        async function showDashboard() {
            currentSection = 'dashboard';
            updateActiveNav();
            document.getElementById('page-title').textContent = 'å„€è¡¨æ¿';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/dashboard', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderDashboard(data);
                }
            } catch (error) {
                showError('è¼‰å…¥å„€è¡¨æ¿å¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“å„€è¡¨æ¿
        function renderDashboard(data) {
            const content = `
                <!-- å¿«é€Ÿå‹•ä½œ -->
                <div class="quick-actions">
                    <div class="quick-action-card" onclick="showUsers()">
                        <div class="quick-action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h3>æ–°å¢ç©å®¶</h3>
                        <p>ç®¡ç†ç©å®¶å¸³è™Ÿèˆ‡ç±Œç¢¼</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="showGameSettings()">
                        <div class="quick-action-icon">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <h3>éŠæˆ²è¨­å®š</h3>
                        <p>èª¿æ•´éŠæˆ²åƒæ•¸èˆ‡å‹ç‡</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="showFinancial()">
                        <div class="quick-action-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <h3>è²¡å‹™å ±è¡¨</h3>
                        <p>æŸ¥çœ‹æ”¶å…¥èˆ‡æ”¯å‡ºçµ±è¨ˆ</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="showIconManager()">
                        <div class="quick-action-icon">
                            <i class="fas fa-icons"></i>
                        </div>
                        <h3>åœ–æ¨™ç®¡ç†</h3>
                        <p>ç®¡ç†éŠæˆ²åœ–æ¨™èˆ‡è¡¨æƒ…ç¬¦è™Ÿ</p>
                    </div>
                </div>
                
                <!-- çµ±è¨ˆå¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç¸½ç©å®¶æ•¸</div>
                        <div class="stat-value">${data.stats.totalUsers}</div>
                        <div class="stat-change positive">
                            <i class="fas fa-user-plus"></i>
                            ä»Šæ—¥æ–°å¢: ${data.stats.todayRegistrations}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ç¸½ç±Œç¢¼</div>
                        <div class="stat-value">${formatNumber(data.stats.totalChips)}</div>
                        <div class="stat-label">USDT</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ç¸½ä¸‹æ³¨</div>
                        <div class="stat-value">${formatNumber(data.stats.totalBet)}</div>
                        <div class="stat-label">USDT</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æ´»èºç©å®¶</div>
                        <div class="stat-value">${data.stats.activePlayers}</div>
                        <div class="stat-label">æœ€è¿‘7å¤©</div>
                    </div>
                </div>
                
                <!-- åœ–è¡¨å€ -->
                <div class="chart-container">
                    <h3 class="chart-title">æ¯æ—¥æ´»èºç©å®¶è¶¨å‹¢</h3>
                    <canvas id="activePlayersChart"></canvas>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <!-- æœ€è¿‘è¨»å†Šç©å®¶ -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>æœ€è¿‘è¨»å†Šçš„ç©å®¶</h3>
                            <button class="btn btn-primary" onclick="showUsers()">
                                <i class="fas fa-eye"></i> æŸ¥çœ‹å…¨éƒ¨
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç©å®¶åç¨±</th>
                                    <th>ç±Œç¢¼</th>
                                    <th>è¨»å†Šæ™‚é–“</th>
                                </tr>
                            </thead>
                            <tbody id="recent-users-table">
                                ${data.recentUsers.slice(0, 5).map(user => `
                                    <tr>
                                        <td>${user.username}</td>
                                        <td>${formatNumber(user.chips)} USDT</td>
                                        <td>${formatDateTime(user.created_at)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- æœ€è¿‘éŠæˆ²è¨˜éŒ„ -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3>æœ€è¿‘éŠæˆ²è¨˜éŒ„</h3>
                            <button class="btn btn-primary" onclick="showGames()">
                                <i class="fas fa-eye"></i> æŸ¥çœ‹å…¨éƒ¨
                            </button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç©å®¶</th>
                                    <th>éŠæˆ²é¡å‹</th>
                                    <th>ä¸‹æ³¨é‡‘é¡</th>
                                    <th>çµæœ</th>
                                </tr>
                            </thead>
                            <tbody id="recent-games-table">
                                ${data.recentGames.slice(0, 5).map(game => `
                                    <tr>
                                        <td>${game.username}</td>
                                        <td>${game.game_type}</td>
                                        <td>${formatNumber(game.bet_amount)} USDT</td>
                                        <td>
                                            <span style="color: ${game.result === 'win' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                                ${game.result === 'win' ? 'å‹åˆ©' : 'å¤±æ•—'}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ç³»çµ±ç‹€æ…‹ -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç³»çµ±ç‹€æ…‹</h3>
                        <div>
                            <button class="btn btn-primary" onclick="refreshSystemStatus()">
                                <i class="fas fa-sync-alt"></i> åˆ·æ–°
                            </button>
                            <button class="btn btn-warning" onclick="openModal('reset-db-modal')">
                                <i class="fas fa-database"></i> é‡ç½®è³‡æ–™åº«
                            </button>
                        </div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <span class="status-indicator status-online"></span>
                                <strong>API ä¼ºæœå™¨:</strong> æ­£å¸¸é‹è¡Œ
                            </div>
                            <div>
                                <span class="status-indicator status-online"></span>
                                <strong>è³‡æ–™åº«:</strong> é€£æ¥æ­£å¸¸
                            </div>
                            <div>
                                <span class="status-indicator status-online"></span>
                                <strong>éŠæˆ²æœå‹™:</strong> å…¨éƒ¨å•Ÿç”¨
                            </div>
                            <div>
                                <span class="status-indicator status-online"></span>
                                <strong>æœ€å¾Œæ›´æ–°:</strong> ${new Date().toLocaleString('zh-TW')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
            
            // åˆå§‹åŒ–åœ–è¡¨
            renderActivePlayersChart();
        }
        
        // æ¸²æŸ“æ´»èºç©å®¶åœ–è¡¨
        function renderActivePlayersChart() {
            const ctx = document.getElementById('activePlayersChart').getContext('2d');
            
            // æ¨¡æ“¬æ•¸æ“š
            const days = ['é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­', 'é€±æ—¥'];
            const data = days.map(() => Math.floor(Math.random() * 50) + 100);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'æ´»èºç©å®¶æ•¸',
                        data: data,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value + ' äºº';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // é¡¯ç¤ºç©å®¶ç®¡ç†
        async function showUsers(page = 1) {
            currentSection = 'users';
            currentUsersPage = page;
            updateActiveNav();
            document.getElementById('page-title').textContent = 'ç©å®¶ç®¡ç†';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/users', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderUsers(data.users);
                }
            } catch (error) {
                showError('è¼‰å…¥ç©å®¶åˆ—è¡¨å¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“ç©å®¶åˆ—è¡¨
        function renderUsers(users) {
            const content = `
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="æœå°‹ç©å®¶åç¨±æˆ– ID..." 
                           onkeyup="searchUsers(this.value)">
                    <i class="fas fa-search search-icon"></i>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç©å®¶åˆ—è¡¨ (${users.length})</h3>
                        <div>
                            <button class="btn btn-primary" onclick="exportUsers()">
                                <i class="fas fa-download"></i> åŒ¯å‡º
                            </button>
                            <button class="btn btn-success" onclick="showAddPlayer()">
                                <i class="fas fa-user-plus"></i> æ–°å¢ç©å®¶
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ç©å®¶ ID</th>
                                <th>ç©å®¶åç¨±</th>
                                <th>ç±Œç¢¼</th>
                                <th>å‹/è² </th>
                                <th>ç¸½ä¸‹æ³¨</th>
                                <th>è¨»å†Šæ™‚é–“</th>
                                <th>æœ€å¾Œç™»å…¥</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            ${users.map(user => `
                                <tr>
                                    <td><code>${user.player_id}</code></td>
                                    <td>
                                        ${user.username}
                                        ${user.is_admin ? '<span style="color: var(--danger); margin-left: 5px;">ğŸ‘‘</span>' : ''}
                                    </td>
                                    <td>
                                        <span style="font-weight: bold; color: ${user.chips > 10000 ? 'var(--success)' : 'var(--admin-blue)'}">
                                            ${formatNumber(user.chips)} USDT
                                        </span>
                                    </td>
                                    <td>${user.wins}/${user.losses}</td>
                                    <td>${formatNumber(user.total_bet)} USDT</td>
                                    <td>${formatDateTime(user.created_at)}</td>
                                    <td>${formatDateTime(user.last_login)}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-primary btn-sm" 
                                                    onclick="editChips('${user.player_id}', '${user.username}', ${user.chips})">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-warning btn-sm" 
                                                    onclick="resetPlayerPassword('${user.player_id}')">
                                                <i class="fas fa-key"></i>
                                            </button>
                                            ${!user.is_admin ? `
                                                <button class="btn btn-danger btn-sm" 
                                                        onclick="deletePlayer('${user.player_id}', '${user.username}')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // æœå°‹ç©å®¶
        function searchUsers(query) {
            const table = document.getElementById('users-table');
            if (!table) return;
            
            const rows = table.getElementsByTagName('tr');
            query = query.toLowerCase();
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            }
        }
        
        // ç·¨è¼¯ç±Œç¢¼
        function editChips(playerId, username, currentChips) {
            document.getElementById('edit-player-id').value = playerId;
            document.getElementById('edit-player-name').value = username;
            document.getElementById('edit-current-chips').value = currentChips;
            document.getElementById('edit-new-chips').value = currentChips;
            document.getElementById('edit-new-chips').focus();
            
            openModal('edit-chips-modal');
        }
        
        // æ›´æ–°ç©å®¶ç±Œç¢¼
        async function updatePlayerChips() {
            try {
                const playerId = document.getElementById('edit-player-id').value;
                const newChips = parseInt(document.getElementById('edit-new-chips').value);
                
                if (isNaN(newChips) || newChips < 0) {
                    showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„ç±Œç¢¼æ•¸é‡');
                    return;
                }
                
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/users/${playerId}/chips`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'session-id': sessionId
                    },
                    body: JSON.stringify({ chips: newChips })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('edit-chips-modal');
                    showUsers();
                    showSuccess('ç©å®¶ç±Œç¢¼å·²æ›´æ–°');
                } else {
                    showError(data.error || 'æ›´æ–°å¤±æ•—');
                }
            } catch (error) {
                showError('æ›´æ–°å¤±æ•—: ' + error.message);
            }
        }
        
        // åˆªé™¤ç©å®¶
        async function deletePlayer(playerId, username) {
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤ç©å®¶ "${username}" å—ï¼Ÿ\næ­¤æ“ä½œå°‡æ°¸ä¹…åˆªé™¤è©²ç©å®¶çš„æ‰€æœ‰è³‡æ–™ï¼`)) {
                return;
            }
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/users/${playerId}`, {
                    method: 'DELETE',
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showUsers();
                    showSuccess('ç©å®¶å·²åˆªé™¤');
                } else {
                    showError(data.error || 'åˆªé™¤å¤±æ•—');
                }
            } catch (error) {
                showError('åˆªé™¤å¤±æ•—: ' + error.message);
            }
        }
        
        // é‡ç½®ç©å®¶å¯†ç¢¼
        async function resetPlayerPassword(playerId) {
            const newPassword = prompt('è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼ˆè‡³å°‘6å€‹å­—å…ƒï¼‰:');
            if (!newPassword || newPassword.length < 6) {
                showError('å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒ');
                return;
            }
            
            // é€™è£¡æ‡‰è©²å‘¼å« API é‡ç½®å¯†ç¢¼
            showSuccess('å¯†ç¢¼å·²é‡ç½®ç‚º: ' + newPassword);
        }
        
        // é¡¯ç¤ºéŠæˆ²è¨˜éŒ„
        async function showGames(page = 1) {
            currentSection = 'games';
            currentGamesPage = page;
            updateActiveNav();
            document.getElementById('page-title').textContent = 'éŠæˆ²è¨˜éŒ„';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/games/history?page=${page}&limit=20`, {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderGames(data);
                }
            } catch (error) {
                showError('è¼‰å…¥éŠæˆ²è¨˜éŒ„å¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“éŠæˆ²è¨˜éŒ„
        function renderGames(data) {
            const { history, pagination } = data;
            
            const content = `
                <div class="table-container">
                    <div class="table-header">
                        <h3>éŠæˆ²è¨˜éŒ„</h3>
                        <div>
                            <select class="form-input" style="width: 150px; margin-right: 10px;" 
                                    onchange="filterGameType(this.value)">
                                <option value="">å…¨éƒ¨éŠæˆ²</option>
                                <option value="baccarat">ç™¾å®¶æ¨‚</option>
                                <option value="slots">è€è™æ©Ÿ</option>
                                <option value="blackjack">21é»</option>
                                <option value="roulette">è¼ªç›¤</option>
                            </select>
                            <button class="btn btn-primary" onclick="exportGameHistory()">
                                <i class="fas fa-download"></i> åŒ¯å‡ºè¨˜éŒ„
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>æ™‚é–“</th>
                                <th>ç©å®¶</th>
                                <th>éŠæˆ²é¡å‹</th>
                                <th>ä¸‹æ³¨é‡‘é¡</th>
                                <th>è´å¾—é‡‘é¡</th>
                                <th>æ·¨æ”¶ç›Š</th>
                                <th>çµæœ</th>
                                <th>è©³ç´°è³‡æ–™</th>
                            </tr>
                        </thead>
                        <tbody id="games-table">
                            ${history.map(game => {
                                const netProfit = game.bet_amount - game.win_amount;
                                return `
                                    <tr>
                                        <td>${formatDateTime(game.created_at)}</td>
                                        <td>${game.username}</td>
                                        <td>
                                            <span class="icon-category">${game.game_type}</span>
                                        </td>
                                        <td>${formatNumber(game.bet_amount)} USDT</td>
                                        <td style="color: ${game.win_amount > 0 ? 'var(--success)' : 'var(--admin-light)'}">
                                            ${formatNumber(game.win_amount)} USDT
                                        </td>
                                        <td style="color: ${netProfit > 0 ? 'var(--danger)' : 'var(--success)'}; font-weight: bold;">
                                            ${netProfit > 0 ? '+' : ''}${formatNumber(netProfit)} USDT
                                        </td>
                                        <td>
                                            <span style="padding: 4px 12px; border-radius: 12px; 
                                                  background: ${game.result === 'win' ? '#c6f6d5' : '#fed7d7'}; 
                                                  color: ${game.result === 'win' ? '#22543d' : '#742a2a'}; 
                                                  font-size: 0.85rem; font-weight: 500;">
                                                ${game.result === 'win' ? 'å‹åˆ©' : 'å¤±æ•—'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-info" onclick="showGameDetails(${game.id})">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    ${pagination.pages > 1 ? `
                        <div class="pagination">
                            <button class="page-btn ${pagination.page === 1 ? 'disabled' : ''}" 
                                    onclick="showGames(${pagination.page - 1})" ${pagination.page === 1 ? 'disabled' : ''}>
                                ä¸Šä¸€é 
                            </button>
                            
                            ${Array.from({length: Math.min(5, pagination.pages)}, (_, i) => {
                                const pageNum = i + 1;
                                return `
                                    <button class="page-btn ${pagination.page === pageNum ? 'active' : ''}" 
                                            onclick="showGames(${pageNum})">
                                        ${pageNum}
                                    </button>
                                `;
                            }).join('')}
                            
                            ${pagination.pages > 5 ? `
                                <span>...</span>
                                <button class="page-btn" onclick="showGames(${pagination.pages})">
                                    ${pagination.pages}
                                </button>
                            ` : ''}
                            
                            <button class="page-btn ${pagination.page === pagination.pages ? 'disabled' : ''}" 
                                    onclick="showGames(${pagination.page + 1})" ${pagination.page === pagination.pages ? 'disabled' : ''}>
                                ä¸‹ä¸€é 
                            </button>
                        </div>
                    ` : ''}
                </div>
                
                <div style="text-align: center; margin-top: 20px; color: var(--admin-light);">
                    é¡¯ç¤ºç¬¬ ${(pagination.page - 1) * pagination.limit + 1} - 
                    ${Math.min(pagination.page * pagination.limit, pagination.total)} ç­†è¨˜éŒ„ï¼Œ
                    ç¸½å…± ${pagination.total} ç­†
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // é¡¯ç¤ºè²¡å‹™å ±è¡¨
        async function showFinancial() {
            currentSection = 'financial';
            updateActiveNav();
            document.getElementById('page-title').textContent = 'è²¡å‹™å ±è¡¨';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/financial/report', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderFinancial(data);
                }
            } catch (error) {
                showError('è¼‰å…¥è²¡å‹™å ±è¡¨å¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“è²¡å‹™å ±è¡¨
        function renderFinancial(data) {
            const { report, totals } = data;
            
            const content = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç¸½éŠæˆ²æ¬¡æ•¸</div>
                        <div class="stat-value">${formatNumber(totals.total_games)}</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ç¸½ä¸‹æ³¨é‡‘é¡</div>
                        <div class="stat-value">${formatNumber(totals.total_bet)}</div>
                        <div class="stat-label">USDT</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">ç¸½æ”¯å‡º</div>
                        <div class="stat-value">${formatNumber(totals.total_win)}</div>
                        <div class="stat-label">USDT</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æ·¨æ”¶ç›Š</div>
                        <div class="stat-value" style="color: ${totals.net_profit > 0 ? 'var(--success)' : 'var(--danger)'}">
                            ${formatNumber(totals.net_profit)}
                        </div>
                        <div class="stat-label">USDT</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>éŠæˆ²æ”¶ç›Šè©³ç´°å ±è¡¨</h3>
                        <div>
                            <input type="date" id="report-start-date" class="form-input" style="width: 150px; margin-right: 10px;">
                            è‡³
                            <input type="date" id="report-end-date" class="form-input" style="width: 150px; margin: 0 10px;">
                            <button class="btn btn-primary" onclick="filterFinancialReport()">
                                <i class="fas fa-filter"></i> ç¯©é¸
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>éŠæˆ²é¡å‹</th>
                                <th>éŠæˆ²æ¬¡æ•¸</th>
                                <th>ç¸½ä¸‹æ³¨é‡‘é¡</th>
                                <th>ç¸½æ”¯å‡º</th>
                                <th>æ·¨æ”¶ç›Š</th>
                                <th>æ”¶ç›Šç‡</th>
                                <th>å¹³å‡æ¯å±€ä¸‹æ³¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.map(item => {
                                const profitRate = ((item.net_profit / item.total_bet) * 100).toFixed(2);
                                const avgBet = (item.total_bet / item.total_games).toFixed(0);
                                
                                return `
                                    <tr>
                                        <td><strong>${item.game_type}</strong></td>
                                        <td>${formatNumber(item.total_games)}</td>
                                        <td>${formatNumber(item.total_bet)} USDT</td>
                                        <td>${formatNumber(item.total_win)} USDT</td>
                                        <td style="color: ${item.net_profit > 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                            ${formatNumber(item.net_profit)} USDT
                                        </td>
                                        <td style="color: ${profitRate > 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                            ${profitRate}%
                                        </td>
                                        <td>${formatNumber(avgBet)} USDT</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">éŠæˆ²æ”¶ç›Šåˆ†å¸ƒåœ–</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
            
            // åˆå§‹åŒ–åœ–è¡¨
            renderRevenueChart(report);
        }
        
        // æ¸²æŸ“æ”¶ç›Šåœ–è¡¨
        function renderRevenueChart(report) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: report.map(item => item.game_type),
                    datasets: [
                        {
                            label: 'ç¸½ä¸‹æ³¨é‡‘é¡',
                            data: report.map(item => item.total_bet),
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        },
                        {
                            label: 'æ·¨æ”¶ç›Š',
                            data: report.map(item => item.net_profit),
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: 'rgb(16, 185, 129)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatNumber(context.raw)} USDT`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + ' USDT';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // éŠæˆ²è¨­å®šé é¢
        async function showGameSettings() {
            currentSection = 'game-settings';
            updateActiveNav();
            document.getElementById('page-title').textContent = 'éŠæˆ²è¨­å®š';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const [settingsRes, statsRes] = await Promise.all([
                    fetch('/api/admin/game-settings', {
                        headers: { 'session-id': sessionId }
                    }),
                    fetch('/api/admin/settings/stats', {
                        headers: { 'session-id': sessionId }
                    })
                ]);
                
                const settingsData = await settingsRes.json();
                const statsData = await statsRes.json();
                
                if (settingsData.success && statsData.success) {
                    renderGameSettings(settingsData.games, statsData.stats);
                }
            } catch (error) {
                showError('è¼‰å…¥éŠæˆ²è¨­å®šå¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“éŠæˆ²è¨­å®š
        function renderGameSettings(games, stats) {
            const content = `
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-label">æ´»èºéŠæˆ²</div>
                        <div class="stat-value">${stats.activeGames}</div>
                        <div class="stat-label">ç¸½å…± ${games.length} å€‹éŠæˆ²</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">åœ–æ¨™ç¸½æ•¸</div>
                        <div class="stat-value">${stats.totalIcons}</div>
                        <div class="stat-label">
                            ${stats.iconsByCategory.map(cat => `${cat.category}: ${cat.count}`).join(' | ')}
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æœ€å¾Œæ›´æ–°</div>
                        <div class="stat-value" style="font-size: 1.5rem;">
                            ${stats.lastUpdated ? formatDateTime(stats.lastUpdated) : 'å¾æœªæ›´æ–°'}
                        </div>
                    </div>
                </div>
                
                <div class="settings-grid">
                    ${games.map(game => `
                        <div class="game-card">
                            <div class="game-header">
                                <h3 class="game-title">${game.game_name}</h3>
                                <span class="game-status ${game.is_active ? 'status-active' : 'status-inactive'}">
                                    ${game.is_active ? 'å•Ÿç”¨ä¸­' : 'å·²åœç”¨'}
                                </span>
                            </div>
                            
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                                ${game.description || 'ç„¡æè¿°'}
                            </p>
                            
                            <div class="game-stats">
                                <div class="stat-item">
                                    <div class="stat-value">${game.win_rate}%</div>
                                    <div class="stat-label">å‹ç‡</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${game.volatility}%</div>
                                    <div class="stat-label">æ³¢å‹•ç‡</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${formatNumber(game.min_bet)}</div>
                                    <div class="stat-label">æœ€ä½ä¸‹æ³¨</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${formatNumber(game.max_bet)}</div>
                                    <div class="stat-label">æœ€é«˜ä¸‹æ³¨</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-primary" onclick="editGame('${game.game_id}')">
                                    <i class="fas fa-edit"></i> ç·¨è¼¯è¨­å®š
                                </button>
                                <button class="btn ${game.is_active ? 'btn-warning' : 'btn-success'}" 
                                        onclick="toggleGameStatus('${game.game_id}', ${game.is_active})">
                                    <i class="fas fa-power-off"></i>
                                    ${game.is_active ? 'åœç”¨' : 'å•Ÿç”¨'}
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
        }
        
        // ç·¨è¼¯éŠæˆ²è¨­å®š
        async function editGame(gameId) {
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/game-settings/${gameId}`, {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const game = data.game;
                    
                    document.getElementById('edit-game-id').value = game.game_id;
                    document.getElementById('edit-game-name').value = game.game_name;
                    document.getElementById('edit-win-rate').value = game.win_rate;
                    document.getElementById('win-rate-slider').value = game.win_rate;
                    document.getElementById('edit-volatility').value = game.volatility;
                    document.getElementById('volatility-slider').value = game.volatility;
                    document.getElementById('edit-min-bet').value = game.min_bet;
                    document.getElementById('edit-max-bet').value = game.max_bet;
                    document.getElementById('edit-jackpot-chance').value = game.jackpot_chance || 0;
                    document.getElementById('edit-is-active').checked = game.is_active === 1;
                    document.getElementById('edit-description').value = game.description || '';
                    
                    openModal('edit-game-modal');
                }
            } catch (error) {
                showError('è¼‰å…¥éŠæˆ²è¨­å®šå¤±æ•—: ' + error.message);
            }
        }
        
        // æ›´æ–°å‹ç‡é¡¯ç¤º
        function updateWinRate(value) {
            document.getElementById('edit-win-rate').value = value;
        }
        
        // æ›´æ–°æ³¢å‹•ç‡é¡¯ç¤º
        function updateVolatility(value) {
            document.getElementById('edit-volatility').value = value;
        }
        
        // ä¿å­˜éŠæˆ²è¨­å®š
        async function saveGameSettings() {
            try {
                const gameId = document.getElementById('edit-game-id').value;
                const settings = {
                    win_rate: parseFloat(document.getElementById('edit-win-rate').value),
                    volatility: parseFloat(document.getElementById('edit-volatility').value),
                    min_bet: parseInt(document.getElementById('edit-min-bet').value),
                    max_bet: parseInt(document.getElementById('edit-max-bet').value),
                    jackpot_chance: parseFloat(document.getElementById('edit-jackpot-chance').value) || 0,
                    is_active: document.getElementById('edit-is-active').checked ? 1 : 0,
                    description: document.getElementById('edit-description').value
                };
                
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/game-settings/${gameId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'session-id': sessionId
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('edit-game-modal');
                    showGameSettings();
                    showSuccess('éŠæˆ²è¨­å®šå·²æ›´æ–°');
                } else {
                    showError(data.error || 'æ›´æ–°å¤±æ•—');
                }
            } catch (error) {
                showError('ä¿å­˜å¤±æ•—: ' + error.message);
            }
        }
        
        // åˆ‡æ›éŠæˆ²ç‹€æ…‹
        async function toggleGameStatus(gameId, currentStatus) {
            try {
                const confirmAction = confirm(`ç¢ºå®šè¦${currentStatus ? 'åœç”¨' : 'å•Ÿç”¨'}é€™å€‹éŠæˆ²å—ï¼Ÿ`);
                if (!confirmAction) return;
                
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`/api/admin/game-settings/${gameId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'session-id': sessionId
                    },
                    body: JSON.stringify({
                        is_active: currentStatus ? 0 : 1
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showGameSettings();
                    showSuccess(`éŠæˆ²å·²${currentStatus ? 'åœç”¨' : 'å•Ÿç”¨'}`);
                }
            } catch (error) {
                showError('æ“ä½œå¤±æ•—: ' + error.message);
            }
        }
        
        // åœ–æ¨™ç®¡ç†é é¢
        async function showIconManager() {
            currentSection = 'icon-manager';
            updateActiveNav();
            document.getElementById('page-title').textContent = 'åœ–æ¨™ç®¡ç†';
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/icons', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    renderIconManager(data.icons);
                }
            } catch (error) {
                showError('è¼‰å…¥åœ–æ¨™å¤±æ•—: ' + error.message);
            }
        }
        
        // æ¸²æŸ“åœ–æ¨™ç®¡ç†
        function renderIconManager(icons) {
            // æŒ‰åˆ†é¡åˆ†çµ„
            const iconsByCategory = {};
            const categories = new Set();
            
            icons.forEach(icon => {
                const category = icon.category || 'æœªåˆ†é¡';
                if (!iconsByCategory[category]) {
                    iconsByCategory[category] = [];
                }
                iconsByCategory[category].push(icon);
                categories.add(category);
            });
            
            // åˆ†é¡æ¨™ç±¤
            const categoryTabs = Array.from(categories).map(category => `
                <button class="category-tab ${category === 'general' ? 'active' : ''}" 
                        onclick="filterIconsByCategory('${category}')">
                    ${category} (${iconsByCategory[category].length})
                </button>
            `).join('');
            
            // åœ–æ¨™ç¶²æ ¼
            const iconGrid = Object.entries(iconsByCategory).map(([category, categoryIcons]) => `
                <div id="icon-category-${category}" class="icon-category" 
                     style="${category !== 'general' ? 'display: none;' : ''}">
                    <h3 style="margin: 20px 0 10px 0;">${category} (${categoryIcons.length})</h3>
                    <div class="icon-grid">
                        ${categoryIcons.map(icon => `
                            <div class="icon-card" onclick="editIcon('${icon.icon_id}')">
                                <div class="icon-display">${icon.icon_code}</div>
                                <div class="icon-name">${icon.icon_name}</div>
                                <div class="icon-category">${icon.category}</div>
                                <div style="margin-top: 10px; font-size: 0.8rem; color: ${icon.is_active ? '#38a169' : '#e53e3e'}">
                                    ${icon.is_active ? 'âœ“ å•Ÿç”¨ä¸­' : 'âœ— å·²åœç”¨'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            const content = `
                <div class="table-header">
                    <h3>åœ–æ¨™ç®¡ç†</h3>
                    <div>
                        <button class="btn btn-primary" onclick="showAddIcon()">
                            <i class="fas fa-plus"></i> æ–°å¢åœ–æ¨™
                        </button>
                        <button class="btn btn-success" onclick="openModal('import-icons-modal')">
                            <i class="fas fa-file-import"></i> æ‰¹é‡åŒ¯å…¥
                        </button>
                    </div>
                </div>
                
                <div class="category-tabs">
                    <button class="category-tab active" onclick="filterIconsByCategory('all')">
                        å…¨éƒ¨åœ–æ¨™ (${icons.length})
                    </button>
                    ${categoryTabs}
                </div>
                
                ${iconGrid}
            `;
            
            document.getElementById('content-area').innerHTML = content;
            
            // è¼‰å…¥ Emoji æ¸…å–®
            loadEmojiList();
        }
        
        // ç¯©é¸åœ–æ¨™åˆ†é¡
        function filterIconsByCategory(category) {
            // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é¡¯ç¤º/éš±è—åˆ†é¡
            if (category === 'all') {
                document.querySelectorAll('.icon-category').forEach(div => {
                    div.style.display = 'block';
                });
            } else {
                document.querySelectorAll('.icon-category').forEach(div => {
                    div.style.display = div.id === `icon-category-${category}` ? 'block' : 'none';
                });
            }
        }
        
        // ç·¨è¼¯åœ–æ¨™
        async function editIcon(iconId) {
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/icons', {
                    headers: { 'session-id': sessionId }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const icon = data.icons.find(i => i.icon_id === iconId);
                    if (icon) {
                        document.getElementById('edit-icon-id').value = icon.icon_id;
                        document.getElementById('edit-icon-name').value = icon.icon_name;
                        document.getElementById('edit-icon-code').value = icon.icon_code;
                        document.getElementById('edit-icon-category').value = icon.category || 'general';
                        document.getElementById('edit-icon-order').value = icon.sort_order || 0;
                        document.getElementById('edit-icon-active').checked = icon.is_active === 1;
                        
                        // æ›´æ–°é è¦½
                        document.getElementById('icon-preview').textContent = icon.icon_code;
                        
                        openModal('edit-icon-modal');
                    }
                }
            } catch (error) {
                showError('è¼‰å…¥åœ–æ¨™å¤±æ•—: ' + error.message);
            }
        }
        
        // é¡¯ç¤ºæ–°å¢åœ–æ¨™
        function showAddIcon() {
            document.getElementById('edit-icon-id').value = '';
            document.getElementById('edit-icon-name').value = '';
            document.getElementById('edit-icon-code').value = '';
            document.getElementById('edit-icon-category').value = 'general';
            document.getElementById('edit-icon-order').value = 0;
            document.getElementById('edit-icon-active').checked = true;
            document.getElementById('icon-preview').textContent = '';
            
            openModal('edit-icon-modal');
        }
        
        // ä¿å­˜åœ–æ¨™
        async function saveIcon() {
            try {
                const iconId = document.getElementById('edit-icon-id').value;
                const iconData = {
                    icon_name: document.getElementById('edit-icon-name').value,
                    icon_code: document.getElementById('edit-icon-code').value,
                    category: document.getElementById('edit-icon-category').value,
                    sort_order: parseInt(document.getElementById('edit-icon-order').value) || 0,
                    is_active: document.getElementById('edit-icon-active').checked ? 1 : 0
                };
                
                if (!iconData.icon_name || !iconData.icon_code) {
                    showError('è«‹å¡«å¯«åœ–æ¨™åç¨±å’Œä»£ç¢¼');
                    return;
                }
                
                const sessionId = localStorage.getItem('sessionId');
                let response;
                
                if (iconId) {
                    // æ›´æ–°ç¾æœ‰åœ–æ¨™
                    response = await fetch(`/api/admin/icons/${iconId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify(iconData)
                    });
                } else {
                    // æ–°å¢åœ–æ¨™
                    iconData.icon_id = `icon_${Date.now()}_${Math.random().toString(36).substr(2, 8)}`;
                    
                    response = await fetch('/api/admin/icons', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify(iconData)
                    });
                }
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('edit-icon-modal');
                    showIconManager();
                    showSuccess(iconId ? 'åœ–æ¨™å·²æ›´æ–°' : 'åœ–æ¨™å·²æ–°å¢');
                } else {
                    showError(data.error || 'ä¿å­˜å¤±æ•—');
                }
            } catch (error) {
                showError('ä¿å­˜å¤±æ•—: ' + error.message);
            }
        }
        
        // è¼‰å…¥ Emoji æ¸…å–®
        function loadEmojiList() {
            const emojiCategories = [
                { name: 'å¸¸ç”¨ç¬¦è™Ÿ', emojis: ['ğŸ’°', 'ğŸ’', 'ğŸ’µ', 'ğŸª™', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸ’¸'] },
                { name: 'éŠæˆ²', emojis: ['ğŸ²', 'ğŸ°', 'ğŸƒ', 'ğŸ¯', 'ğŸ®', 'ğŸ‘¾', 'ğŸ•¹ï¸', 'ğŸ§©'] },
                { name: 'å¡ç‰‡', emojis: ['ğŸ‚¡', 'ğŸ‚±', 'ğŸƒ', 'ğŸƒ‘', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸', 'â™ ï¸'] },
                { name: 'é£Ÿç‰©', emojis: ['ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ‘', 'ğŸŒ'] },
                { name: 'æ˜Ÿæ˜Ÿ', emojis: ['â­', 'ğŸŒŸ', 'âœ¨', 'ğŸ’«', 'ğŸŒ ', 'â˜„ï¸', 'ğŸŒŒ', 'ğŸ”¯'] },
                { name: 'çå‹µ', emojis: ['ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ–ï¸', 'ğŸ…', 'ğŸ‘‘', 'ğŸ’'] },
                { name: 'å…¶ä»–', emojis: ['ğŸ”¥', 'â„ï¸', 'âš¡', 'ğŸ’§', 'ğŸŒŠ', 'ğŸŒˆ', 'â˜€ï¸', 'ğŸŒ™'] }
            ];
            
            const emojiList = document.getElementById('emoji-list');
            if (emojiList) {
                emojiList.innerHTML = emojiCategories.map(cat => `
                    <div style="margin-bottom: 15px;">
                        <strong style="font-size: 0.9rem; color: #666;">${cat.name}</strong>
                        <div style="margin-top: 5px;">
                            ${cat.emojis.map(emoji => `
                                <span class="emoji-item" onclick="selectEmoji('${emoji}', '${cat.name}')">
                                    ${emoji}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // é¸æ“‡ Emoji
        function selectEmoji(emoji, category) {
            selectedEmojis.push({
                icon_name: `Emoji_${emoji}`,
                icon_code: emoji,
                category: category.toLowerCase()
            });
            
            updateEmojiSelection();
        }
        
        // æ›´æ–°å·²é¸æ“‡çš„ Emoji é¡¯ç¤º
        function updateEmojiSelection() {
            const container = document.getElementById('emoji-selection');
            if (container) {
                container.innerHTML = selectedEmojis.map(emoji => `
                    <span class="selected-emoji">
                        ${emoji.icon_code}
                        <span style="font-size: 0.8rem; color: #666; margin-left: 5px;">
                            ${emoji.icon_name}
                        </span>
                    </span>
                `).join('');
            }
            
            // æ›´æ–°åŒ¯å…¥æ–‡æœ¬æ¡†
            const importTextarea = document.getElementById('import-icons-data');
            if (importTextarea) {
                importTextarea.value = JSON.stringify(selectedEmojis, null, 2);
            }
        }
        
        // åŒ¯å…¥åœ–æ¨™
        async function importIcons() {
            try {
                const importTextarea = document.getElementById('import-icons-data');
                let icons;
                
                try {
                    icons = JSON.parse(importTextarea.value);
                } catch (error) {
                    showError('JSON æ ¼å¼éŒ¯èª¤');
                    return;
                }
                
                if (!Array.isArray(icons) || icons.length === 0) {
                    showError('è«‹æä¾›æœ‰æ•ˆçš„åœ–æ¨™è³‡æ–™');
                    return;
                }
                
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/icons/batch-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'session-id': sessionId
                    },
                    body: JSON.stringify({ icons })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('import-icons-modal');
                    selectedEmojis = [];
                    showIconManager();
                    showSuccess(`æˆåŠŸåŒ¯å…¥ ${data.summary.imported} å€‹åœ–æ¨™ï¼Œè·³é ${data.summary.skipped} å€‹é‡è¤‡åœ–æ¨™`);
                } else {
                    showError(data.error || 'åŒ¯å…¥å¤±æ•—');
                }
            } catch (error) {
                showError('åŒ¯å…¥å¤±æ•—: ' + error.message);
            }
        }
        
        // ç³»çµ±è¨­ç½®é é¢
        async function showSystem() {
            currentSection = 'system';
            updateActiveNav();
            document.getElementById('page-title').textContent = 'ç³»çµ±è¨­ç½®';
            
            const content = `
                <div class="quick-actions">
                    <div class="quick-action-card" onclick="openModal('reset-db-modal')">
                        <div class="quick-action-icon" style="color: var(--danger);">
                            <i class="fas fa-database"></i>
                        </div>
                        <h3>é‡ç½®è³‡æ–™åº«</h3>
                        <p>æ¸…é™¤æ‰€æœ‰è³‡æ–™ä¸¦é‡ç½®ç³»çµ±</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="backupDatabase()">
                        <div class="quick-action-icon" style="color: var(--success);">
                            <i class="fas fa-save"></i>
                        </div>
                        <h3>è³‡æ–™åº«å‚™ä»½</h3>
                        <p>å‚™ä»½ç•¶å‰è³‡æ–™åº«ç‹€æ…‹</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="clearCache()">
                        <div class="quick-action-icon" style="color: var(--warning);">
                            <i class="fas fa-broom"></i>
                        </div>
                        <h3>æ¸…é™¤å¿«å–</h3>
                        <p>æ¸…é™¤ç³»çµ±å¿«å–è³‡æ–™</p>
                    </div>
                    
                    <div class="quick-action-card" onclick="systemLogs()">
                        <div class="quick-action-icon" style="color: var(--info);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3>ç³»çµ±æ—¥èªŒ</h3>
                        <p>æŸ¥çœ‹ç³»çµ±æ“ä½œè¨˜éŒ„</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç³»çµ±è³‡è¨Š</h3>
                        <button class="btn btn-primary" onclick="refreshSystemInfo()">
                            <i class="fas fa-sync-alt"></i> åˆ·æ–°
                        </button>
                    </div>
                    <table>
                        <tbody>
                            <tr>
                                <td style="width: 200px;"><strong>ç³»çµ±ç‰ˆæœ¬</strong></td>
                                <td>å¿«æ´»å¨›æ¨‚åŸ v1.0.0</td>
                            </tr>
                            <tr>
                                <td><strong>è³‡æ–™åº«é¡å‹</strong></td>
                                <td>SQLite</td>
                            </tr>
                            <tr>
                                <td><strong>ä¼ºæœå™¨æ™‚é–“</strong></td>
                                <td id="server-time-display">${new Date().toLocaleString('zh-TW')}</td>
                            </tr>
                            <tr>
                                <td><strong>è¨˜æ†¶é«”ä½¿ç”¨</strong></td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${Math.floor(Math.random() * 30) + 30}%"></div>
                                    </div>
                                    <small>${Math.floor(Math.random() * 30) + 30}% ä½¿ç”¨ä¸­</small>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>æœ€å¾Œå‚™ä»½</strong></td>
                                <td>${new Date(Date.now() - 86400000).toLocaleString('zh-TW')} (24å°æ™‚å‰)</td>
                            </tr>
                            <tr>
                                <td><strong>ç³»çµ±ç‹€æ…‹</strong></td>
                                <td>
                                    <span class="status-indicator status-online"></span>
                                    <span style="color: var(--success);">æ­£å¸¸é‹è¡Œ</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>ç³»çµ±è¨­ç½®</h3>
                    </div>
                    <div style="padding: 20px;">
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="maintenance-mode"> ç¶­è­·æ¨¡å¼
                            </label>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                å•Ÿç”¨å¾Œå°‡æš«åœæ‰€æœ‰éŠæˆ²æœå‹™
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æ–°ç©å®¶èµ·å§‹ç±Œç¢¼</label>
                            <input type="number" class="form-input" value="1000" min="100" max="10000">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æ¯æ—¥ç°½åˆ°çå‹µ</label>
                            <input type="number" class="form-input" value="100" min="0" max="1000">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">æœ€å¤§åŒæ™‚åœ¨ç·šç©å®¶</label>
                            <input type="number" class="form-input" value="1000" min="100" max="10000">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">è‡ªå‹•æ¸…ç†éæœŸæœƒè©±</label>
                            <select class="form-input">
                                <option value="1">æ¯å°æ™‚</option>
                                <option value="24" selected>æ¯æ—¥</option>
                                <option value="168">æ¯é€±</option>
                            </select>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-primary" onclick="saveSystemSettings()">
                                <i class="fas fa-save"></i> ä¿å­˜è¨­ç½®
                            </button>
                            <button class="btn" onclick="resetSystemSettings()">
                                <i class="fas fa-undo"></i> æ¢å¾©é è¨­
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = content;
            
            // æ›´æ–°ä¼ºæœå™¨æ™‚é–“
            setInterval(() => {
                const timeDisplay = document.getElementById('server-time-display');
                if (timeDisplay) {
                    timeDisplay.textContent = new Date().toLocaleString('zh-TW');
                }
            }, 1000);
        }
        
        // é‡ç½®è³‡æ–™åº«
        async function confirmResetDatabase() {
            const confirmText = document.getElementById('reset-confirm').value;
            
            if (confirmText !== 'YES_RESET') {
                showError('è«‹è¼¸å…¥ YES_RESET ç¢ºèªé‡ç½®');
                return;
            }
            
            try {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/api/admin/reset-database', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'session-id': sessionId
                    },
                    body: JSON.stringify({ confirm: confirmText })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal('reset-db-modal');
                    showSuccess('è³‡æ–™åº«å·²é‡ç½®ï¼Œç³»çµ±å°‡é‡æ–°å•Ÿå‹•');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showError(data.error || 'é‡ç½®å¤±æ•—');
                }
            } catch (error) {
                showError('é‡ç½®å¤±æ•—: ' + error.message);
            }
        }
        
        // å·¥å…·å‡½æ•¸
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        function showError(message) {
            showNotification(message, 'error');
        }
        
        function showInfo(message) {
            showNotification(message, 'info');
        }
        
        function showNotification(message, type) {
            // ç§»é™¤ç¾æœ‰çš„é€šçŸ¥
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notificationDiv = document.createElement('div');
            notificationDiv.className = `notification ${type}`;
            notificationDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notificationDiv);
            
            setTimeout(() => {
                notificationDiv.style.opacity = '0';
                notificationDiv.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notificationDiv.parentNode) {
                        document.body.removeChild(notificationDiv);
                    }
                }, 300);
            }, 3000);
        }
        
        function showLoading() {
            const contentArea = document.getElementById('content-area');
            if (contentArea) {
                contentArea.innerHTML = '<div class="loader"></div>';
            }
        }
        
        function hideLoading() {
            // ä¸éœ€è¦ç‰¹åˆ¥è™•ç†ï¼Œå…§å®¹æœƒç›´æ¥è¦†è“‹
        }
        
        function formatNumber(num) {
            if (num === undefined || num === null) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        function formatDateTime(dateTime) {
            if (!dateTime) return 'å¾æœª';
            const date = new Date(dateTime);
            return date.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // ç›£è½åœ–æ¨™ä»£ç¢¼è¼¸å…¥
        document.addEventListener('input', function(e) {
            if (e.target.id === 'edit-icon-code') {
                document.getElementById('icon-preview').textContent = e.target.value;
            }
        });
        
        // åˆå§‹åŒ–
        window.onload = checkAdminAuth;
    </script>
</body>
</html>